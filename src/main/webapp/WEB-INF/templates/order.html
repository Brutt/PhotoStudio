<!DOCTYPE html>
<html th:lang="${language}" xmlns:th="http://www.w3.org/1999/xhtml" class="no-js">

<head>
    <head>
        <meta th:replace="fragment/head.html :: meta">
        <link th:replace="fragment/head.html :: link">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
              integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ"
              crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" th:href="@{/assets/css/order.css}">
        <title>Order Page</title>
    </head>
</head>



<body th:with="isAdmin=${user.userRole.getName()=='ADMIN'}" >
<div th:if="${isAdmin==false}">
    <header class="header">
        <div class="container-fluid">
            <!--NavBar-->
            <nav th:replace="fragment/navigation.html :: nav"></nav>
            <hr class="header__underscore">
            <!--NavBarEnd-->
        </div>
    </header>
</div>

<div class="container" th:if="${isAdmin}">

    <!--Bread Crumb-->
    <div class="bread__crumb-navigation">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a class="breadcrumb__link" th:href="@{/admin}">Admin page</a></li>
                <li class="breadcrumb-item"><a class="breadcrumb__link" th:href="@{/orders}">Order journal</a></li>
                <li class="breadcrumb-item breadcrumb-item__active" aria-current="page">New order</li>
            </ol>
        </nav>
    </div>
</div>
<!--Bread Crumb End-->

<h1 class="order__title" th:text="#{order.title}">Order</h1>

<h2 class="error" align="center" th:if="${errorMessage!=null}" th:text="${errorMessage}"></h2>

<!--<form id="fileUploadForm" method="post" th:action="@{/order}" >-->
<div class="container order">
    <div class="order__main-info">
        <div th:if="${order.id != 0}" class="order__detail-info order__number" th:text="${order.id}"></div>
        <div class="order__detail-info order__date"
             th:text="${#temporals.format(order.orderDate,'dd-MM-yyyy HH:mm')}"></div>
        <div class="order__detail-info order__status" th:text="${order.status}"></div>
    </div>
    <form id="new" th:action="${order.id} == 0 ? @{/order} : @{/orders}" th:method="${order.id} == 0 ? post : get"
          th:enctype="${order.id} == 0 ? 'multipart/form-data' : null">
        <div class="order__user-info" th:if="${isAdmin}">
            <input type="email" class="form-control order__detail-info order__user-email"
                   id="email"
                   th:attr="value=${((newEmail != null) ? newEmail : (order.id != 0) ? order.user.email : null)},
                            placeholder=${order.user == null and newEmail == null ? 'Email' : null}"
                   name="email" required>
            <a th:href="${order.id} == 0 ? @{/admin/users?search=userForOrder} : @{'/admin/users?search=userForOrder&id=' + ${order.id}}"
               class="btn btn-submit btn-outline-dark button order__button order__search-button">Search user</a>
            <a th:href="@{/user}" class="btn btn-submit btn-outline-dark button order__button order__status-button">Create
                new
                user</a>
        </div>
        <div>
            <textarea class="form-control order__detail-info order__comment"
                      id="comment" rows="5" name="comment"
                      th:attr="placeholder=${order.comment == null ? 'Comment' : null}"
                      th:text="${order.comment != null}?${order.comment}"></textarea>

        </div>
        <div class="order__photos">
            <div class="photo-aria overflow-auto">
                <div class="row order__block">
                    <div class="col-md-3" th:each="photo : ${order.photoSources}">
                        <div class="order__photo-block">
                            <div class="photo-select-checkbox form-check">
                                <!--id="selectPhoto" th:value="${photo.getId()}"-->
                                <input class="form-check-input" type="checkbox" th:name="'order'+${order.id}+'Photo'+${photo.getId()}"
                                       value="selected">
                            </div>
                            <img class="order__photo" th:src="@{/photo(id= ${photo.getId()})}" alt="photo">
                        </div>
                        <div class="photo__buttons">
                            <div class="container">
                                <div class="row justify-content-center">
                                    <a class="photo-option" href="#"><i class="fas fa-search-plus"></i></a>
                                    <a class="photo-option" href="#" th:if="${isAdmin}"><i class="fas fa-trash-alt"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="photo-add-delete-buttons" th:if="${isAdmin}">

                <input type="file" name="photo" id="file" class="inputfile"
                       data-multiple-caption="{count} file(s) selected" multiple th:accept="${acceptedFileTypes}"/>
                <label for="file" class="btn  btn-submit btn-outline-dark button order__button photo-add-button">
                    <span>Add</span>
                </label>

                <a class="photo-option" href="#">
                    <button type="button"
                            class="btn btn-submit btn-outline-dark button order__button photo-delete-button">
                        Delete all
                    </button>
                </a>
            </div>
        </div>
        <div class="container" th:if="${isAdmin==false and order.status.getOrderStatusName()=='SELECTED'}">
            <div class="row align-items-center">
                <div class="col justify-content-center">
                    <p th:text="#{order.thank.you}">Thanks for your choice! Photos will be available after payment.</p>
                </div>
            </div>
        </div>
        <div class="order__complete-buttons">
            <button type="submit" class="btn btn-submit btn-outline-dark btn-lg button order__button save-button" th:text="#{order.save.button}">
                Save
            </button>
            <button th:if="${isAdmin and order.id != 0}"
                    class="btn btn-submit btn-outline-dark button order__button view-select-button"
                    form="change_status">
                Status to view
                and
                select
            </button>
            <button th:if="${isAdmin and order.id != 0}" type="button"
                    class="btn btn-submit btn-outline-dark button order__button delete-button"
                    data-toggle="modal" data-target="#delete-order">Delete order
            </button>
        </div>
    </form>
    <div class="modal fade" id="delete-order" tabindex="-1" role="dialog" aria-labelledby="delete-order-title"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title dialog-title" id="delete-order-title">Confirm delete</h5>
                </div>
                <div class="modal-body">
                    <p class="dialog-body"
                       th:text="'Are you sure you want to delete order with id '+${order.id}+' ?'"></p>
                </div>
                <div class="modal-footer dialog-buttons">
                    <button class="btn btn-submit btn-outline-dark button dialog__button
                            delete-button" data-dismiss="modal">No
                    </button>
                    <button class="btn btn-submit btn-outline-dark button dialog__button delete-button"
                            form="delete_order">Yes
                    </button>
                </div>
            </div>
        </div>
    </div>
    <form id="delete_order" th:if="${order.id != 0}" th:action="@{'/order/delete/'+${order.id}}" method="post"></form>
    <form id="change_status" th:if="${order.id != 0}" th:action="@{'/order/forward/'+${order.id}}" method="post"></form>
</div>
</body>
<meta th:replace="fragment/script.html :: script">

<script th:src="@{/assets/js/order/custom-file-input.js}"></script>

</html>